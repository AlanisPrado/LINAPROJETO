<div class="meu-cardapio-container">

  <div class="header">
    <h1>Meu Cardápio</h1>
    <p>Visualize suas refeições organizadas por dia da semana</p>
    <p class="refeicoes-planejadas">{{ totalRefeicoesPlanejadas }}/28 refeições planejadas</p>
  </div>

  <div class="dias-semana">
    <button
      *ngFor="let dia of diasSemana"
      (click)="selecionarDia(dia)"
      [ngClass]="{ ativo: dia === diaSelecionado }"
    >
      {{ getNomeCurtoDia(dia) }}
    </button>
  </div>

  <div class="dia-atual-container">
    <h2 class="nome-dia">{{ getNomeCurtoDia(diaSelecionado) }}</h2>
  </div>

  <div class="refeicoes-grid" *ngIf="cardapioDoDia$ | async as refeicoesDia">

    <ng-container *ngFor="let periodoFixo of periodosDoDia">

      <div
        class="refeicao-card"
        *ngIf="refeicoesDia[periodoFixo.nome] as refeicaoAtual"
      >

        <div class="refeicao-header">
          <span class="icone">{{ refeicaoAtual.icone }}</span>
          <span class="periodo-nome">{{ refeicaoAtual.nome }}</span>
        </div>

        <div class="refeicao-conteudo">
          <h4
            class="prato"
            [ngClass]="{'adicionar-texto': refeicaoAtual.prato === 'Adicionar Refeição'}"
          >
            {{ refeicaoAtual.prato }}
          </h4>

          <div class="botoes">
            <button
              class="btn-receita"
              (click)="verReceita(refeicaoAtual.prato)"
              *ngIf="refeicaoAtual.prato !== 'Adicionar Refeição'"
            >
              <span></span>
              Ver Receita
            </button>

            <button
              class="btn-adicionar"
              (click)="adicionarRefeicao(refeicaoAtual.nome)"
              *ngIf="refeicaoAtual.prato === 'Adicionar Refeição'"
            >
              Adicionar Refeição
            </button>

            <button
              class="btn-mudar"
              (click)="mudarRefeicao(refeicaoAtual.nome)"
              *ngIf="refeicaoAtual.prato !== 'Adicionar Refeição'"
            >
              Mudar
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- Modal de Receita -->
<div class="modal-overlay" *ngIf="modalReceitaAberto" (click)="fecharModalReceita()">
  <div class="modal-receita" (click)="$event.stopPropagation()" *ngIf="receitaAtual">
    <div class="modal-header">
      <div class="modal-titulo">
        <span class="modal-icone">{{ getIconeCor(periodoAtual).icone }}</span>
        <div>
          <span class="modal-periodo">{{ periodoAtual }}</span>
          <h3 class="modal-prato">{{ receitaAtual.nome }}</h3>
        </div>
      </div>
      <button class="btn-fechar" (click)="fecharModalReceita()">×</button>
    </div>

    <div class="modal-conteudo">
      <div class="secao-adequado" *ngIf="receitaAtual.adequadoPara.length > 0">
        <h4>Adequado para</h4>
        <div class="tags">
          <span class="tag" *ngFor="let tag of receitaAtual.adequadoPara">{{ tag }}</span>
        </div>
      </div>

      <div class="secao-ingredientes">
        <h4>Ingredientes</h4>
        <ul class="lista-ingredientes">
          <li *ngFor="let ingrediente of receitaAtual.ingredientes">{{ ingrediente }}</li>
        </ul>
      </div>

      <div class="secao-preparo">
        <h4>Modo de Preparo</h4>
        <p class="texto-preparo">{{ receitaAtual.modoPreparo }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-mudar-modal" (click)="mudarRefeicaoDoModal()">Mudar</button>
    </div>
  </div>
</div>

<!-- Modal de Seleção de Receitas -->
<div class="modal-overlay" *ngIf="modalSelecaoAberto" (click)="fecharModalSelecao()">
  <div class="modal-selecao" (click)="$event.stopPropagation()">
    <div class="modal-selecao-header">
      <h2 class="modal-selecao-titulo">Escolher nova receita para {{ periodoParaSelecionar }}</h2>
      <button class="btn-fechar" (click)="fecharModalSelecao()">×</button>
    </div>

    <div class="modal-selecao-conteudo">
      <div class="receitas-grid">
        <div
          class="receita-card-selecao"
          *ngFor="let opcao of opcoesReceitas"
          (click)="selecionarReceita(opcao)"
        >
          <div class="receita-card-header">
            <span class="receita-icone">{{ getIconeCor(periodoParaSelecionar).icone }}</span>
            <h3 class="receita-nome">{{ opcao.nome }}</h3>
          </div>
          <div class="receita-ingredientes">
            <span
              class="ingrediente-tag"
              *ngFor="let ingrediente of opcao.ingredientes.slice(0, 3)"
            >
              {{ ingrediente }}
            </span>
            <span
              class="ingrediente-mais"
              *ngIf="opcao.ingredientes.length > 3"
            >
              ... e mais {{ opcao.ingredientes.length - 3 }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
